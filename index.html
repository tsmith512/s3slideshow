<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.106.0.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      font-size: inherit;
    }

    body {
      background: black;
      font-size: 1em;
    }

    img {
      display: block;
      width: 100%;
      height: auto;
    }

    #slideshow {
      width: 100;
      height: 100vh;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1;
    }

    .slide {
      position: absolute;
      width: 100%;
      height: 100vh;
      background: black; /* So preloading images beneath won't show through the letterbox */
    }

    .slide img {
      position: relative;
      top: 50%;
      transform: translateY(-50%);
    }

    .active {
      z-index: 10;
    }


  </style>
</head>
<body>
  <div id="slideshow"></div>

  <script type="text/javascript">
    var s3 = new AWS.S3;
    var bucketName = 'tsmith-thirdfloor-pres';
    var slideshowContainer = document.getElementById('slideshow');
    var images = [];
    AWS.config.region = 'us-west-1';

    var bucket = new AWS.S3({
      params: {
        Bucket: bucketName
      }
    });

    // See https://github.com/aws/aws-sdk-js/issues/206#issuecomment-30873852
    // since I'm not going to store credentials in a public facing webpage, and
    // it's a public access bucket anywhere.
    function unauthenticatedRequest(operation, params, callback) {
      var request = s3[operation](params);
      request.removeListener('validate', AWS.EventListeners.Core.VALIDATE_CREDENTIALS);
      request.removeListener('sign', AWS.EventListeners.Core.SIGN);
      request.send(callback);
    }

    // Taken from http://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html
    // which lists objects from the bucket, but adapted to use the unauthenticatedRequest above.
    function listObjs() {
      unauthenticatedRequest('listObjects', {
        Bucket: bucketName,
        Prefix: 'photos/'
      }, function (err, data) {
        if (err) {
          slideshowContainer.innerHTML = 'ERROR: ' + err;
        } else {
          data.Contents.forEach(function (obj) {
            // Skip the /photos directory and any subfolder keys
            if (!obj.Size) { return; }

            images.push({
              filename: obj.Key,
              src: document.location.protocol + '//' + bucketName + '.s3-' + AWS.config.region + '.amazonaws.com/' + obj.Key
            })

          });
          makeSlides();
        }
      });
    }

    function makeSlides() {
      var slideFirst = document.createElement('div');
      slideFirst.className = "slide active";

      var imageFirst = document.createElement('img');
      imageFirst.setAttribute('src', images[0].src);
      imageFirst.setAttribute('alt', images[0].filename);

      slideshowContainer.appendChild(slideFirst);
      slideFirst.appendChild(imageFirst);
    }

    listObjs();
  </script>

</body>
</html>
